<section class="demande-service">
  <h2 class="form-title">Demande de service</h2>

  <form [formGroup]="demandeForm" (ngSubmit)="onSubmit()" class="service-form">
    <div class="form-row">
      <div class="form-group">
        <label for="typeService">Type de service</label>
        <select id="typeService" formControlName="typeService">
          <option value="" disabled>Sélectionnez un service</option>
          <option *ngFor="let service of services" [value]="service.service_id">
            {{ service.nom_service }}
          </option>
        </select>
        <div *ngIf="demandeForm.get('typeService')?.invalid && demandeForm.get('typeService')?.touched" class="error">
          Veuillez sélectionner un type de service.
        </div>
      </div>

      <div class="form-group">
        <label for="deliveryDate">Date estimée de livraison</label>
        <input type="date" id="deliveryDate" formControlName="deliveryDate" aria-required="true">
        <div *ngIf="demandeForm.get('deliveryDate')?.invalid && demandeForm.get('deliveryDate')?.touched" class="error">
          Veuillez sélectionner une date.
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="description">Description des besoins</label>
      <textarea id="description" formControlName="description" rows="5" aria-required="true"></textarea>
      <div *ngIf="demandeForm.get('description')?.invalid && demandeForm.get('description')?.touched" class="error">
        La description est requise (minimum 10 caractères).
      </div>
    </div>

    <div class="form-group">
      <label for="files">Fichiers joints</label>
      <input type="file" id="files" (change)="onFileChange($event)" multiple aria-describedby="file-help">
      <small id="file-help">Vous pouvez joindre plusieurs fichiers (PDF, images, etc.).</small>
    </div>

    <div class="form-group">
      <label for="montantFinal">Montant estimé (Ar)</label>
      <input
        type="number"
        id="montantFinal"
        formControlName="montantFinal"
        [attr.min]="selectedService?.prix_minimum || 0"
        [placeholder]="getMontantPlaceholder()"
        (input)="onMontantInput($event)"
        aria-required="true"
        step="1000"
      />
      <small *ngIf="selectedService?.prix_minimum" class="min-price-hint">
        {{ getMinPriceHint() }}
      </small>
      <div *ngIf="demandeForm.get('montantFinal')?.hasError('required') && demandeForm.get('montantFinal')?.touched" class="error">
        Le montant est obligatoire.
      </div>
      <div *ngIf="demandeForm.get('montantFinal')?.hasError('min') && demandeForm.get('montantFinal')?.touched" class="error">
        Le montant doit être supérieur ou égal à {{ getMinPriceHint() }}.
      </div>
    </div>

    <div class="form-actions">
      <button type="submit" [disabled]="demandeForm.invalid" class="btn-submit">Envoyer la demande</button>
    </div>

    <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>
  </form>

  <!-- Boîte de confirmation -->
  <div class="confirmation-modal" *ngIf="showConfirmation">
    <div class="modal-content">
      <h3>Demande envoyée avec succès !</h3>
      <p>Merci, vous recevrez des notifications lorsque votre commande sera validée par l’administrateur.</p>
      <button (click)="closeConfirmation()">OK</button>
    </div>
  </div>
</section>