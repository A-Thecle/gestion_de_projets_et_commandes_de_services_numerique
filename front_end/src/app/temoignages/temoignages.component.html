<div class="temoignages-container">

  

  <div>
    <h2>Témoignages Clients</h2>

    <div class="testimonials-row" *ngIf="publishedTemoignages.length > 0;">
        <div class="testimonials-line">
            <article class="testimonial-card" *ngFor="let t of publishedTemoignages; let i = index">
                <div class="testimonial-header">
                    <div class="avatar-placeholder"></div>
                    <div class="client-info">
                        <strong>{{ t.client?.nom }} {{ t.client?.prenom }}</strong>
                        <div class="rating">
                            <!-- étoiles pleines -->
                            <ng-container *ngFor="let _ of getStars(t.note)">
                                <span class="star full">★</span>
                            </ng-container>
                            <!-- étoiles vides -->
                            <ng-container *ngFor="let _ of getEmptyStars(t.note)">
                                <span class="star empty">☆</span>
                            </ng-container>
                        </div>
                    </div>
                </div>

                <p class="comment">{{ t.commentaire }}</p>

                <div class="meta">
                    <span class="date">{{ t.date_soumission | date: 'dd/MM/yyyy' }}</span>
                    <span class="project-title" *ngIf="t.projet">{{ t.projet.titre_projet }}</span>
                </div>
            </article>
        </div>
        <hr class="separator" *ngIf="publishedTemoignages.length > 0">
    </div>
<button class="open-popup-btn" (click)="showPopup = true">Laisser un témoignage</button>

    
</div>

  <!-- Popup -->
  <div class="popup" *ngIf="showPopup">
    <div class="popup-content">
      <span class="close-btn" (click)="showPopup = false">&times;</span>
      <h3>Laisser un témoignage</h3>

      <form #temoignageForm="ngForm" (ngSubmit)="envoyer()" novalidate>
        
        <!-- Choix du projet -->
        <!-- Choix du projet -->
<label>Projet concerné</label>
<select *ngIf="temoignage" [(ngModel)]="temoignage.id_projet" name="id_projet" required>
  <option *ngFor="let p of projets" [value]="p.projet_id">
    {{ p.titre_projet }} - {{ p.date_creation | date }}
  </option>
</select>


        <label>Note (1 à 5)</label>
        <input
          type="number"
          [(ngModel)]="temoignage.note"
          name="note"
          min="1"
          max="5"
          required
          #note="ngModel"
        >
        <div *ngIf="note.invalid && note.touched" class="error">
          La note doit être entre 1 et 5.
        </div>

        <label>Commentaire</label>
        <textarea
          [(ngModel)]="temoignage.commentaire"
          name="commentaire"
          minlength="20"
          required
          #commentaire="ngModel"
        ></textarea>
        <div *ngIf="commentaire.invalid && commentaire.touched" class="error">
          Le commentaire doit contenir au moins 20 caractères.
        </div>

        <button type="submit" [disabled]="temoignageForm.invalid">Envoyer</button>
      </form>

      <p *ngIf="message" class="notification">{{ message }}</p>
    </div>
  </div>
</div>


 <!-- Boîte de confirmation -->
<div class="confirmation-modal" *ngIf="showConfirmation">
  <div class="modal-content">
    <h3>Téoignage envoyée avec succès !</h3>
    <p>Merci, vous recevrez des notifications lorsque votre témoignage sera publié par l’administrateur.</p>
    <button (click)="closeConfirmation()">OK</button>
  </div>
</div>
